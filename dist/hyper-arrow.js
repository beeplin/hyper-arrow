function r(e,t,r){var n=[f,e,Object.create(null),[]];if("object"!=typeof t||Array.isArray(t))r=t;else for(var o in t)n[2][o]=o.startsWith("on")?t[o]:a(t[o],n,o);var i,l=a(r,n)??[];for(i in l)n[3].push(g(a(l[i],n,"#"+i)));return n}let o=Symbol("brand"),f=document.createElement("_"),i=null,h=new Map;var e=new Proxy({},{get:(e,t)=>r.bind(null,t)});function t(e,t){document.querySelector(e).append(y(t))}function n(t,e){return a(t,void 0,void 0,e),()=>{for(var e of h.keys())e[0]===t&&h.delete(e)}}function l(e){return e!==Object(e)||s(e)?e:new Proxy(e,{get(e,t){var r,n;return t===o||(r=Reflect.get(e,t),"function"==typeof e&&"prototype"===t?r:(i&&(h.has(i)||h.set(i,[]),(n=h.get(i)).some(e=>e[0]===e&&e[1]===t)||n.push([e,t])),l(r)))},set(e,t,r){var n=Reflect.get(e,t),o=Reflect.set(e,t,r);if(!Object.is(n,r)||"length"===t)for(var[i,l]of h.entries())for(var f of l)if(f[0]===n&&(f[0]=r),f[0]===e&&f[1]===t){var s,a,c,u,[f,d,y,p]=i,f=f();if(d)if(y)"#"===y[0]?(c=+y.slice(1),m(d[3][c]),k(d,c,g(f))):(u=a=s=c=void 0,s=y,a=f,[c,,u]=c=d,u[s]!==a&&w(c,s,u[s]=a));else{for(var v of d[3])m(v);_(d,f)}else p&&p(f)}return o}})}let s=e=>!!e[o];function a(e,t,r,n){if("function"!=typeof e)return e;i=t?[e,t,r]:[e,,,n];t=e();return i=null,t}function g(e){return"string"!=typeof e?e:[f,null,{},[],null,e]}function m(e){for(var t of h.keys())!function t(e,r){if(!r)return!1;if(e===r)return!0;let n=e[3].some(e=>t(e,r));return n}(e,t[1])||h.delete(t)}function y(e){if("string"!=typeof e[1])return n=e,console.log("vt:",n),i=document.createTextNode(n[5]),(n[0]=i).__hyper_arrow__=n,i;var t,r=e,[,n,o,i]=r,l=document.createElement(n);for(t in l.dataset.id=Math.random().toString().slice(2,4),console.log("children:",i),l.append(...i.map(y)),o)w(l,t,o[t]);if(r[0]=l,o.cacheChildrenByKey&&p(i)){r[4]=new Map;for(var f of i)r[4].set(f[2].key,f[0])}return l.__hyper_arrow__=r,l}function p(e){var t=e.filter(e=>"key"in e[2]).map(e=>e[2].key);if(new Set(t).size!==t.length)throw new Error("duplicate keys");return t.length===e.length?t:null}function _(r,t){let n=p(t);var e=r[3].filter(e=>"key"in e[2]).map(e=>e[2].key);if(n&&e.length===r[3].length){var o,i=r[3].filter(e=>n.includes(e[2].key));for(o of r[3])i.includes(o)||r[0].removeChild(o[0]);r[3]=i;var l,f,s,a,c=r[4];for([l,f]of t.entries()){let t=f[2].key;t!==r[3][l]?.[2].key&&(s=r[3].findIndex(e=>e[2].key===t),a=r[3][s]?.[0]??c?.get(t)??y(f),-1!==s?(r[0].removeChild(a),r[3].splice(s,1),r[3].splice(l,0,r[3][s])):(f[0]=a,r[3].splice(l,0,f),c&&!c.has(t)&&c.set(t,a)),r[0].insertBefore(a,r[0].childNodes.item(l))),k(r,l,f)}}else{var u=t.length,d=r[3].length;for(let e=0;e<u||e<d;e++)e<u&&e<d?k(r,e,t[e]):e>=d?r[0].appendChild(y(t[e])):r[0].lastChild?.remove();r[3]=t}}function k(e,t,r){console.log("vn:",r);var n,o,i=e[3][t];if("string"==typeof i[1]&&"string"==typeof r[1]&&i[1]===r[1]){var l,[f,,s]=i;let[,,t,e]=r;for(l in r[0]=f,t)t[l]!==s[l]&&w(f,l,t[l]);for(let e in s)e in t||(n=f,"$"===(o=e)[0]?n.style[o.slice(1)]=null:"_"===o[0]||o.toLowerCase()in n.attributes?n.removeAttribute(o.replace(/^_/,"").toLowerCase()):n[o]=void 0);["innerText","innerHTML","textContent"].some(e=>e in t)||_(i,e)}else{i=y(r);e[0].replaceChild(i,e[0].childNodes[t]),e[4]?.set(r[2].key,i)}e[3][t]=r}function w(e,t,r){"$"===(t="class"!==t&&"for"!==t?t:"_"+t)[0]?e.style[t.slice(1)]=r:"_"===t[0]?e.setAttribute(t.slice(1),r):t.startsWith("on")?e[t.toLowerCase()]=r:e[t]=r}export{h as deps,r as h,e as tags,t as mount,n as watch,l as reactive,s as isReactive};